<!DOCTYPE html>
<html lang="th" id="htmlTag">

<head>
  <meta charset="UTF-8">
  <title>SMC-JV System (logs)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bs-body-bg);
    }

    .navbar-custom {
      background: linear-gradient(90deg, #a29bfe 0%, #9b59b6 100%);
      box-shadow: 0px 4px 15px rgba(155, 89, 182, 0.3);
    }

    .navbar-custom .navbar-brand,
    .navbar-custom .nav-link {
      color: #fff !important;
      font-weight: 500;
    }

    .navbar-custom .nav-link:hover {
      color: #f2eaff !important;
    }

    /* Container */
    h2 {
      font-weight: 700;
      color: #6c5ce7;
      margin-bottom: 1.5rem;
    }

    /* Table Style */
    .table-card {
      border-radius: 18px;
      background: #fff;
      box-shadow: 0 4px 18px rgba(155, 89, 182, 0.15);
      overflow: hidden;
    }

    th {
      background-color: #9b59b6;
      color: #fff;
    }

    .badge {
      font-size: 0.85rem;
    }

    /* Dark Mode */
    body.dark {
      background-color: #121212;
      color: #e0e0e0;
    }

    body.dark .table-card {
      background: #1f1f1f;
    }

    body.dark th {
      background-color: #6c5ce7;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">üè• SMC JV System</a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="/add-patient">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</a>
        <a class="nav-link" href="/list-patients">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</a>
        <a class="nav-link" href="/">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
        <a class="nav-link" href="#" id="logoutBtn">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        <button id="darkModeToggle" class="btn btn-outline-light ms-3 rounded-pill">üåô Dark Mode</button>
      </div>
    </div>
  </nav>

  <!-- Content -->
  <div class="container my-5">
    <h2>üìí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <div class="table-responsive table-card">
      <table class="table table-striped align-middle" id="logTable">
        <thead>
          <tr>
            <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
            <th>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
            <th>‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
            <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
          </tr>
        </thead>
        <tbody id="logTableBody"><!-- JS Fill --></tbody>
      </table>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ‡πÇ‡∏´‡∏•‡∏î log
      fetch('/logs/all')
        .then(res => res.json())
        .then(logs => {
          const tbody = document.getElementById('logTableBody');
          logs.forEach(l => {
            tbody.innerHTML += `
              <tr>
                <td>${new Date(l.timestamp).toLocaleString('th-TH')}</td>
                <td>${l.username || '-'}</td>
                <td><span class="badge bg-${l.action === 'DELETE' ? 'danger' : l.action === 'UPDATE' ? 'warning' : 'success'}">${l.action}</span></td>
                <td>${l.description}</td>
              </tr>`;
          });
        });
    });
    // Script ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', (e) => {
        e.preventDefault(); // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        Swal.fire({
          title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',
          text: "‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
          cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = '/auth/logout'; // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà route logout
          }
        });
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/main.js"></script>
</body>

</html>